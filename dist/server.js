!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=7)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(18);t.base64=i.Base64;const n=e=>"id"===e||"permissions"===e||"birthday"===e||"creationdate"===e||"updatingdate"===e||"likes"===e||"dislikes"===e||"latest"===e||"projectId"===e||"fwId"===e||"projectid"===e||"fwid"===e||"appId"===e||"appid"===e||"fullimage"===e||"isOnline"===e||"isActive"===e||"silentUpdate"===e||"annoncedate"===e||"closingdate"===e,o=e=>"isOnline"===e||"isActive"===e||"silentUpdate"===e,r=e=>"apps"===e;t.getIdFromUrl=((e,t=0)=>{const s=e.split("/");return+s[s.length-(1+t)]}),t.createEntity=(e=>{delete e.id,delete e.creationdate,delete e.updatingdate;let s="creationdate, ",i="NOW(), ";for(const r in e)if(s+=`${r}, `,n(r))o(r)?i+=`${e[r]}, `:i+=`'${e[r]}', `;else if(Array.isArray(e[r])){let s="";for(const t of e[r])s+=t+"$$";i+=`'${t.base64.encode(s)}', `}else i+=`'${t.base64.encode(e[r])}', `;return{fields:s=s.substring(0,s.length-2),values:i=i.substring(0,i.length-2)}}),t.updateEntity=(e=>{delete e.id,delete e.creationdate,delete e.updatingdate;let s="updatingdate = NOW(), ";for(const i in e)if(n(i))o(i)?s+=`${i} = ${e[i]}, `:s+=`${i} = '${e[i]}', `;else if(Array.isArray(e[i])){let n="";for(const t of e[i])n+=t+"$$";s+=`${i} = '${t.base64.encode(n)}', `}else s+=`${i} = '${t.base64.encode(e[i])}', `;return s=s.substring(0,s.length-2)}),t.decodeEntity=(e=>{const s={};Object.assign(s,e);for(const e in s){const i=s[e];if(o(e)&&(s[e]=i[0]),!n(e)&&i){s[e]=t.base64.decode(i);const n=s[e];n&&(isNaN(+n)||(s[e]=+n)),r(e)&&(s[e]=t.base64.decode(i).split("$$"))}}return s}),t.setFilters=(e=>{let s="";for(const i in e)n(i)?s+=`${i}=${e[i]} AND `:s+=`${i}='${t.base64.encode(e[i])}' AND `;return s=`WHERE ${s.substring(0,s.length-5)}`}),t.attackerDetails=(e=>{return{body:e.body,cookies:e.cookies,headers:e.headers,params:e.params,method:e.method,hostname:e.hostname,ip:e.ip,originalUrl:e.originalUrl,fresh:e.fresh,stale:e.stale}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(17);const n=new class{constructor(){this._logger=i.createLogger({format:i.format.combine(i.format.timestamp(),i.format.printf(e=>`\n    ${e.timestamp} [${e.level}]: ${e.message}`)),transports:[new i.transports.Console,new i.transports.File({filename:"combined.log"})]})}_info(e){this._logger.info(e)}get info(){return this._info}_error(e,t){let s=e+". ";t&&(s+=JSON.stringify(t,null,4)),this._logger.error(s)}get error(){return this._error}};t.default=n},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(15),o=s(16);const r=new class{constructor(){this._config=o.default}get sqlRequest(){return this._sqlRequest}_sqlRequest(e){return i(this,void 0,void 0,function*(){try{const t=yield n.createConnection(this._config),s=yield t.query(e);return t.end(),s}catch(e){throw e}})}};t.default=r},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(0),o=s(2),r=s(19);s(4).config();const d=new class{get login(){return this._login}get verifyToken(){return this._verifyToken}_login(e,t,s=!1){return i(this,void 0,void 0,function*(){try{const i=s?"officers":"users",d=yield o.default.sqlRequest(`\n                SELECT id, login, email, permissions FROM ${i} WHERE password='${n.base64.encode(t)}' AND email='${n.base64.encode(e)}';\n            `);return d[0]?{token:r.sign({id:d[0].id},process.env.SECRET,{expiresIn:86400}),code:200,id:d[0].id,login:n.base64.decode(d[0].login),email:n.base64.decode(d[0].email)}:{token:"",code:401,id:0,login:"",email:""}}catch(e){throw e}})}_verifyToken(e,t=!1){return i(this,void 0,void 0,function*(){try{if(e.headers&&e.headers.authorization){const s=e.headers.authorization;let i;r.verify(s,process.env.SECRET,(e,t)=>{if(e)throw e;i=t});const n=t?"officers":"users",d=yield o.default.sqlRequest(`\n                    SELECT email, permissions FROM ${n} WHERE id="${i.id}";\n                `);return d[0]?{authorized:!0,permissions:d[0].permissions,id:i.id}:{authorized:!1,permissions:0,id:0}}return{authorized:!1,permissions:0,id:0}}catch(e){throw e}})}};t.default=d},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(8);global.Promise=i,s(4).config();const n=process.env.PORT,o=s(9),r=s(1),d=s(37),a=s(39).create();a.on("error",e=>{r.default.error("Domain error",e)}),a.run(()=>{o.default.listen(n,()=>{r.default.info(`Express server listening on port ${n}`);new d.default(o.default)})})},function(e,t){e.exports=require("bluebird")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(10),n=s(11),o=s(12),r=s(13),d=s(14),a=s(20),u=s(21),l=s(22),f=s(23),c=s(24),p=s(25),h=s(26),y=s(27),w=s(30),m=s(31),v=s(32),g=s(33),E=s(34),R=s(35),$=s(36);const q=(new class{constructor(){this.app=i(),this._routePrv=new r.CrmRoutes,this._devRoutes=new d.DevRoutes,this._userApiRoutes=new a.UserApiRoutes,this._newsApiRoutes=new u.NewsApiRoutes,this._statisticsApiRoutes=new l.StatisticsApiRoutes,this._fwVersionsApiRoutes=new f.FwVersionsApiRoutes,this._userAdminRoutes=new c.OfficersAdminRoutes,this._devicesAdminRoutes=new p.DevicesAdminRoutes,this._projectsAdminRoutes=new h.ProjectsAdminRoutes,this._fwsAdminRoutes=new y.FwsAdminRoutes,this._appsAdminRoutes=new w.AppsAdminRoutes,this._fwsProjectsLinksAdminRoutes=new m.FwsProjectsLinksAdminRoutes,this._appLinksAdminRoutes=new v.AppLinksAdminRoutes,this._newsAdminRoutes=new g.NewsAdminRoutes,this._statisticsAdminRoutes=new E.StatisticsAdminRoutes,this._adminRoutes=new R.AdminRoutes,this._config(),this._setApiRoutes(),this._setAdminRoutes()}_config(){this.app.use(o()),this.app.use(n.json()),this.app.use(n.urlencoded({extended:!1}))}_setApiRoutes(){this._routePrv.routes(this.app),this._devRoutes.routes(this.app),this._userApiRoutes.routes(this.app),this._newsApiRoutes.routes(this.app),this._statisticsApiRoutes.routes(this.app),this._fwVersionsApiRoutes.routes(this.app),this._newsAdminRoutes.routes(this.app)}_setAdminRoutes(){this._adminRoutes.routes(this.app),this._userAdminRoutes.routes(this.app),this._devicesAdminRoutes.routes(this.app),this._projectsAdminRoutes.routes(this.app),this._fwsAdminRoutes.routes(this.app),this._appsAdminRoutes.routes(this.app),this._fwsProjectsLinksAdminRoutes.routes(this.app),this._statisticsAdminRoutes.routes(this.app),this._appLinksAdminRoutes.routes(this.app)}}).app,k=new $.Server(q);t.default=k},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cors")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CrmRoutes=class{routes(e){e.route("/api/support").post((e,t)=>{t.status(200).send({message:"You tried to create a new support report..."})}),e.route("/api/support/history").post((e,t)=>{t.status(200).send({message:"You got the support reports history..."})}),e.route("/api/partners").get((e,t)=>{t.status(200).send({message:"You got the partners list..."})}),e.route("/api/partners/:id").get((e,t)=>{t.status(200).send({message:"You got the single partner detail..."})}),e.route("/api/partners").get((e,t)=>{t.status(200).send({message:"You got the company info..."})}),e.route("/entity").get((e,t)=>{t.status(200).send({message:"GET request successful."})}).post((e,t)=>{t.status(200).send({message:"POST request successful."})}),e.route("/entity/:entityId").get((e,t)=>{t.status(200).send({message:"GET request successful."})}).put((e,t)=>{t.status(200).send({message:"PUT request successful."})}).delete((e,t)=>{t.status(200).send({message:"DELETE request successful."})})}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(5),r=s(1),d=s(3),a=s(0);t.DevRoutes=class{routes(e){e.route("/").get((e,t)=>{t.status(200).send("The server works fine...")}),e.route("/api/dev/getLogs").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);s?s.authorized?8!==s.permissions?(r.default.error("user with low permissions tried to get logs",a.attackerDetails(e)),t.sendStatus(403)):(t.sendFile(o.join(process.cwd(),"/combined.log")),r.default.info(`logs were sent to ${e.ip}`)):(r.default.error("unauthorized user tried to get logs",a.attackerDetails(e)),t.sendStatus(401)):(r.default.error(`failed to send logs to ${e.ip}`,{validity:s}),t.status(500).send({validity:s}))}catch(s){r.default.error(`failed to send logs to ${e.ip}`,s),t.status(500).send("logs sending failed...")}})),e.route("/api/dev/testDbConnection").get((e,t)=>i(this,void 0,void 0,function*(){try{yield n.default.sqlRequest("SELECT * FROM users"),t.status(200).send("db connection is fine!")}catch(e){console.error("test db connection error:"),console.error(e),t.status(500).send("db connection failed...")}})),e.route("/api/dev/mysqler").post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield n.default.sqlRequest(e.body.query);t.status(200).send({rows:s})}catch(e){console.error(""),console.error("mysqler error:"),console.error(e),t.status(500).send(e)}}))}}},function(e,t){e.exports=require("promise-mysql")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s(4).config();const i={host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE,port:+process.env.DB_PORT};t.default=i},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("js-base64")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(3),d=s(0),a=s(6),u=s(5),l=s(0);t.UserApiRoutes=class{routes(e){e.route("/api/user").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e);if(s.authorized){const e=yield n.default.sqlRequest(`\n                            SELECT *, NULL AS password FROM users WHERE id=${s.id};\n                        `),i=d.decodeEntity(e[0]);o.default.info(`got user id:${i.id} info`),t.status(200).send({user:i})}else o.default.error("unauthorized user tried to get user info",d.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("get user info failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=d.createEntity(e.body);yield n.default.sqlRequest(`\n                        INSERT INTO users (${s.fields}) VALUES (${s.values});\n                    `),o.default.info(`new user ${e.body.login} created`),t.sendStatus(201)}catch(e){o.default.error("new user creation failed",e),t.status(500).send(e)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e);if(s.authorized){const i=d.updateEntity(e.body);yield n.default.sqlRequest(`\n                            UPDATE users SET ${i} WHERE id=${s.id};\n                        `),o.default.info(`user id:${s.id} info updated`),t.sendStatus(200)}else o.default.error("unauthorized user tried to update user info",d.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("update user info failed",e),t.status(500).send(e)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e);s.authorized?(yield n.default.sqlRequest(`\n                            DELETE FROM users WHERE id="${s.id}";\n                        `),o.default.info(`user id:${s.id} deleted`),t.sendStatus(200)):(o.default.error(`unauthorized user tried to delete user id:${s.id} info`),t.sendStatus(401))}catch(e){o.default.error("delete user failed",e),t.status(500).send(e)}})),e.route("/api/user/login").post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.login(e.body.email,e.body.password);switch(s.code){case 200:yield n.default.sqlRequest(`\n                                UPDATE users SET isOnline = 1 WHERE email = '${l.base64.encode(e.body.email)}';\n                            `),o.default.info(`user ${e.body.email} login`),t.status(200).send({token:s.token});break;case 401:o.default.info(`incorrect password by user ${e.body.login}`),t.sendStatus(401);break;default:o.default.error("something wrong with autorization",e.body)}}catch(s){o.default.error(`login failed for ${e.body.email}`,s),t.status(500).send(s)}})),e.route("/api/user/logout").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e);s.authorized?(yield n.default.sqlRequest(`\n                            UPDATE users SET isOnline = 0 WHERE id = ${s.id};\n                        `),o.default.info(`user id:${s.id} logout`),t.sendStatus(200)):(o.default.error(`unauthorized user tried to logout user id:${s.id} info`),t.sendStatus(401))}catch(e){o.default.error("user logout failed",e),t.status(500).send(e)}})),e.route("/api/user/checking-update").post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e);if(s.authorized)if(e.body&&e.body.brand&&e.body.model){const i=yield n.default.sqlRequest("\n                                SELECT * FROM fwversions WHERE fullimage = 0;\n                            ");if(i.length){const e=d.decodeEntity(i[i.length-1]);o.default.info(`current fw version info was sent to user id:${s.id}`),t.status(200).send(e)}else o.default.error(`there is no fw versions for user's id:${s.id} device`,e.body),t.status(204).send("There is no firmware versions for your device")}else o.default.error(`not enough data to get the current fw version info for user id:${s.id}`,e.body),t.status(412).send("Not enough data to get the current firmware version info. You must specify: brand, model");else o.default.error("unauthorized user tried to get fw versions info",e),t.sendStatus(401)}catch(e){o.default.error("current fw version info sending to user failed",e),t.status(500).send(e)}})),e.route("/api/user/update").post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e);if(s.authorized)if(e.body&&e.body.brand&&e.body.model&&"isRoot"in e.body)if(e.body.isRoot)t.status(200).send("temporarily unavailable...");else{const i=yield n.default.sqlRequest("\n                                    SELECT * FROM fwversions WHERE fullimage = 1 AND ;\n                                ");if(i.length){const s=d.decodeEntity(i[i.length-1]),n=u.join(process.cwd(),`update/${e.body.brand}/${e.body.model}/${s.version.substring(0,s.version.length-1)}/fullimage/${s.version}.txt`);a.stat(n,(e,s)=>{e||!s.isFile()?(o.default.error("incorrect version request",e),t.sendStatus(404)):t.sendFile(n)}),t.sendStatus(200)}else o.default.error(`there is no fw versions for user's id:${s.id} device`,e.body),t.status(204).send("There is no firmware versions for your device")}else"isRoot"in e.body?(o.default.error(`not enough data to get the current fw version info for user id:${s.id}`,e.body),t.status(412).send("Not enough data to get the current firmware version info. You must specify: brand, model")):(o.default.error(`there is no isRoot info in request from user id:${s.id}`,e.body),t.status(412).send("Your aplication can't send correct request"));else o.default.error("unauthorized user tried to update fw version"),t.sendStatus(401)}catch(e){o.default.error("fw version updating by user failed",e),t.status(500).send(e)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0);t.NewsApiRoutes=class{routes(e){e.route("/api/news").get((e,t)=>i(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                        SELECT * FROM news ${s};\n                    `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("news were sent"),t.status(200).send(i)}catch(e){o.default.error("news sending failed",e),t.status(500).send(e)}})),e.route("/api/news/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM news WHERE id=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`the new id:${s} was sent`),t.status(200).send(d)}catch(s){o.default.error(`new id:${r.getIdFromUrl(e.originalUrl)} sending failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(0);t.StatisticsApiRoutes=class{routes(e){e.route("/api/statistics").post((e,t)=>i(this,void 0,void 0,function*(){try{if(o.default.error("statistics from spb",e.body),(yield n.default.sqlRequest(`\n                        SELECT * FROM devices WHERE imei = '${d.base64.encode(e.body.imei)}';\n                    `))[0]){const s=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                            UPDATE devices SET ${s} WHERE imei='${d.base64.encode(e.body.imei)}';\n                        `),o.default.info(`device imei:${e.body.imei} statistics updated`),t.sendStatus(200)}else{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                            INSERT INTO devices (${s.fields}) VALUES (${s.values});\n                        `),o.default.info(`new device ${e.body.imei} added to statistics`),t.sendStatus(200)}}catch(e){o.default.error("new device adding to statistics failed",e),t.status(500).send(e)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0);t.FwVersionsApiRoutes=class{routes(e){e.route("/api/fw-versions").get((e,t)=>i(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                        SELECT * FROM fwversions ${s};\n                    `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("fw-versions were sent to user"),t.status(200).send(i)}catch(e){o.default.error("fw-versions sending to user failed",e),t.status(500).send(e)}})),e.route("/api/fw-versions/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM fwversions WHERE id=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`version id:${s} was sent to user`),t.status(200).send(d)}catch(s){o.default.error(`version id:${r.getIdFromUrl(e.originalUrl)} sending to user failed`,s),t.status(500).send(s)}})),e.route("/api/fw-versions/update").get((e,t)=>i(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                        SELECT * FROM fwversions ${s};\n                    `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("versions were sent to user"),t.status(200).send(i)}catch(e){o.default.error("versions sending to user failed",e),t.status(500).send(e)}})),e.route("/api/fw-versions/update/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM fwversions WHERE id=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`version id:${s} was sent to user`),t.status(200).send(d)}catch(s){o.default.error(`version id:${r.getIdFromUrl(e.originalUrl)} sending to user failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(3);t.OfficersAdminRoutes=class{routes(e){e.route("/api/admin/officers").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(8!==s.permissions)o.default.error("user with low permissions tried to get officers list as admin",r.attackerDetails(e)),t.sendStatus(403);else{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                                SELECT *, NULL AS password FROM officers ${s};\n                            `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("officers were sent to admin"),t.status(200).send(i)}else o.default.error("unauthorized user tried to get officers list as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("officers sending to admin failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(8!==s.permissions)o.default.error("user with low permissions tried to create new officer as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                                INSERT INTO officers (${s.fields}) VALUES (${s.values});\n                            `),o.default.info(`new officer "${e.body.login}" created by admin`),t.sendStatus(201)}else o.default.error("unauthorized user tried to create new officer as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("new officer creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/officers/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield d.default.verifyToken(e,!0);if(i.authorized)if(8!==i.permissions)o.default.error(`user with low permissions tried to get officer id:${s} info as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const e=yield n.default.sqlRequest(`\n                                SELECT *, NULL AS password FROM officers WHERE id=${s};\n                            `),i=r.decodeEntity(e[0]);o.default.info(`officer id:${s} info was sent to admin`),t.status(200).send(i)}else o.default.error(`unauthorized user tried to get officer id:${s} info as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`officer id:${r.getIdFromUrl(e.originalUrl)} info sending to admin failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield d.default.verifyToken(e,!0);if(i.authorized)if(8!==i.permissions)o.default.error(`user with low permissions tried to update officer id:${s} info as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const i=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                                UPDATE officers SET ${i} WHERE id="${s}";\n                            `),o.default.info(`officer id:${s} updated`),t.sendStatus(200)}else o.default.error(`unauthorized user tried to update officer id:${s} info as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`update officer id:${r.getIdFromUrl(e.originalUrl)} by admin failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield d.default.verifyToken(e,!0);i.authorized?8!==i.permissions?(o.default.error(`user with low permissions tried to delete officer id:${s} info as admin`,r.attackerDetails(e)),t.sendStatus(403)):(yield n.default.sqlRequest(`\n                                DELETE FROM officers WHERE id="${s}";\n                            `),o.default.info(`officer id:${s} deleted by admin`),t.sendStatus(200)):(o.default.error(`unauthorized user tried to delete officer id:${s} info as admin`,r.attackerDetails(e)),t.sendStatus(401))}catch(s){o.default.error(`delete officer id:${r.getIdFromUrl(e.originalUrl)} by admin failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0);t.DevicesAdminRoutes=class{routes(e){e.route("/api/admin/devices").get((e,t)=>i(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                        SELECT * FROM devices ${s};\n                    `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("devices were sent to admin"),t.status(200).send(i)}catch(e){o.default.error("devices sending to admin failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                        INSERT INTO devices (${s.fields}) VALUES (${s.values});\n                    `),o.default.info(`new device "${e.body.imei}" created by admin`),t.sendStatus(201)}catch(e){o.default.error("new device creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/devices/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM devices WHERE id=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`device id:${s} was sent to admin`),t.status(200).send(d)}catch(s){o.default.error(`device id:${r.getIdFromUrl(e.originalUrl)} sending to admin failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                        UPDATE devices SET ${i} WHERE id="${s}";\n                    `),o.default.info(`device id:${s} updated`),t.sendStatus(200)}catch(s){o.default.error(`update device id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl);yield n.default.sqlRequest(`\n                        DELETE FROM devices WHERE id="${s}";\n                    `),o.default.info(`device id:${s} deleted by admin`),t.sendStatus(200)}catch(s){o.default.error(`delete device id:${r.getIdFromUrl(e.originalUrl)} by admin failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(3);t.ProjectsAdminRoutes=class{routes(e){e.route("/api/admin/projects").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<6)o.default.error("user with low permissions tried to get projects list as admin",r.attackerDetails(e)),t.sendStatus(403);else{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                                SELECT * FROM projects ${s};\n                            `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("projects were sent to admin"),t.status(200).send(i)}else o.default.error("unauthorized user tried to get projects list as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("projects sending to admin failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(8!==s.permissions)o.default.error("user with low permissions tried to create new project list as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                                INSERT INTO projects (${s.fields}) VALUES (${s.values});\n                            `);const i=r.setFilters(e.body),d=yield n.default.sqlRequest(`\n                                SELECT projectId FROM projects ${i};\n                            `);o.default.info(`new project "${e.body.name}" created by admin`),t.status(201).send(d[0])}else o.default.error("unauthorized user tried to create new project as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("new project creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/projects/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<6)o.default.error("user with low permissions tried to get project info as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                                SELECT * FROM projects WHERE projectId=${s};\n                            `),d=r.decodeEntity(i[0]);o.default.info(`project id:${s} was sent to admin`),t.status(200).send(d)}else o.default.error("unauthorized user tried to get project info as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`project id:${r.getIdFromUrl(e.originalUrl)} sending to admin failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(8!==s.permissions)o.default.error("user with low permissions tried to update project info as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.getIdFromUrl(e.originalUrl),i=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                                UPDATE projects SET ${i} WHERE projectId="${s}";\n                            `),o.default.info(`project id:${s} updated`),t.sendStatus(200)}else o.default.error("unauthorized user tried to update project info as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`update project id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(8!==s.permissions)o.default.error("user with low permissions tried to delete project info as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.getIdFromUrl(e.originalUrl);let i=yield n.default.sqlRequest(`\n                                SELECT id FROM fwProjectLink WHERE projectId=${s};\n                            `);for(const e of i)n.default.sqlRequest(`\n                                    DELETE FROM fwProjectLink WHERE id=${e.id};\n                                `);i=yield n.default.sqlRequest(`\n                                SELECT id FROM fwAppProjectLink WHERE projectId=${s};\n                            `);for(const e of i)n.default.sqlRequest(`\n                                    UPDATE fwAppProjectLink SET projectId = NULL WHERE id=${e.id};\n                                `);yield n.default.sqlRequest(`\n                                DELETE FROM projects WHERE projectId=${s};\n                            `),o.default.info(`project id:${s} deleted by admin`),t.sendStatus(200)}else o.default.error("unauthorized user tried to delete project info as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`delete project id:${r.getIdFromUrl(e.originalUrl)} by admin failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(28),a=s(5),u=s(6);s(29);t.FwsAdminRoutes=class{routes(e){e.route("/api/admin/fws").get((e,t)=>i(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                        SELECT * FROM fws ${s};\n                    `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("fws were sent to admin"),t.status(200).send(i)}catch(e){o.default.error("fws sending failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                        INSERT INTO fws (${s.fields}) VALUES (${s.values});\n                    `);const i=r.setFilters(e.body),d=yield n.default.sqlRequest(`\n                        SELECT fwId FROM fws ${i};\n                    `);o.default.info(`new fw "${e.body.name}" created`),t.status(201).send(d[0])}catch(e){o.default.error("new fw creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/fws/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM fws WHERE fwId=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`fw id:${s} was sent to admin`),t.status(200).send(d)}catch(s){o.default.error(`fw id:${r.getIdFromUrl(e.originalUrl)} sending failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                        UPDATE fws SET ${i} WHERE fwId="${s}";\n                    `),o.default.info(`fw id:${s} updated`),t.sendStatus(200)}catch(s){o.default.error(`update fw id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl);let i=yield n.default.sqlRequest(`\n                        SELECT id FROM fwProjectLink WHERE fwId=${s};\n                    `);for(const e of i)n.default.sqlRequest(`\n                            DELETE FROM fwProjectLink WHERE id=${e.id};\n                        `);i=yield n.default.sqlRequest(`\n                        SELECT id FROM fwAppProjectLink WHERE fwId=${s};\n                    `);for(const e of i)n.default.sqlRequest(`\n                            UPDATE fwAppProjectLink SET fwId = NULL WHERE id=${e.id};\n                        `);yield n.default.sqlRequest(`\n                        DELETE FROM fws WHERE fwId=${s};\n                    `),o.default.info(`fw id:${s} deleted`),t.sendStatus(200)}catch(s){o.default.error(`delete fw id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})),e.route("/api/admin/fws/upload").post((e,t)=>i(this,void 0,void 0,function*(){try{const s=["multipart/form-data"];if(e.headers&&e.headers["content-type"]&&s.includes(String(e.headers["content-type"]).split(";")[0])){e.on("file",()=>{console.log("file!")});const s=1e6,i=["bin","mp4"],n=a.join(process.cwd(),"/files/fw/"),o=new d({headers:e.headers});o.on("file",function(o,r,d,a,l){let f="201";const c=d.split("."),p=c[c.length-1];if(!i.includes(p.toLowerCase()))return void("201"===f&&(f="422",t.sendStatus(422)));let h=0;const y=u.createWriteStream(n+d,{flags:"wx"});y.on("error",e=>{"EEXIST"===e.code?"201"===f&&(f="409",t.sendStatus(409),y.destroy()):"201"===f&&(f="500",t.sendStatus(500),y.destroy())}),y.on("close",()=>{"201"===f&&t.sendStatus(201)}),e.on("close",()=>{"201"===f&&(f="500",t.sendStatus(500)),y.destroy()}),r.pipe(y),r.on("data",function(e){(h+=e.length)>s&&("201"===f&&(f="413",t.sendStatus(413)),y.destroy())})}),o.on("field",function(e,t,s,i,n,o){}),e.pipe(o)}else t.sendStatus(422)}catch(e){o.default.error("new fw creation failed",e),t.status(500).send(e)}}))}}},function(e,t){e.exports=require("busboy")},function(e,t){e.exports=require("async-mkdirp")},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0);t.AppsAdminRoutes=class{routes(e){e.route("/api/admin/apps").get((e,t)=>i(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                        SELECT * FROM apps ${s};\n                    `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("apps were sent to admin"),t.status(200).send(i)}catch(e){o.default.error("apps sending failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                        INSERT INTO apps (${s.fields}) VALUES (${s.values});\n                    `);const i=r.setFilters(e.body),d=yield n.default.sqlRequest(`\n                        SELECT appId FROM apps ${i};\n                    `);o.default.info(`new app "${e.body.name}" created`),t.status(201).send(d[0])}catch(e){o.default.error("new app creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/apps/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM apps WHERE appId=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`app id:${s} was sent to admin`),t.status(200).send(d)}catch(s){o.default.error(`app id:${r.getIdFromUrl(e.originalUrl)} sending failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                        UPDATE apps SET ${i} WHERE appId="${s}";\n                    `),o.default.info(`app id:${s} updated`),t.sendStatus(200)}catch(s){o.default.error(`update app id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT id FROM fwAppProjectLink WHERE appId=${s};\n                    `);for(const e of i)n.default.sqlRequest(`\n                            DELETE FROM fwAppProjectLink WHERE id=${e.id};\n                        `);yield n.default.sqlRequest(`\n                        DELETE FROM apps WHERE appId=${s};\n                    `),o.default.info(`app id:${s} deleted`),t.sendStatus(200)}catch(s){o.default.error(`delete app id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(3);t.FwsProjectsLinksAdminRoutes=class{routes(e){e.route("/api/admin/fw-project-links").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to get fw-project links as admin",r.attackerDetails(e)),t.sendStatus(403);else{const e=[];(yield n.default.sqlRequest("\n                                SELECT * FROM fwProjectLink;\n                            ")).forEach((t,s)=>{e[s]=n.default.sqlRequest(`\n                                    SELECT * FROM projects, fws, fwProjectLink\n                                    WHERE projects.projectId = ${t.projectId}\n                                    AND fws.fwId = ${t.fwId}\n                                    AND fwProjectLink.projectid = ${t.projectId}\n                                    AND fwProjectLink.fwid = ${t.fwId};\n                                `)});const s=yield Promise.all(e);for(let e=0;e<s.length;e++)s[e]=r.decodeEntity(s[e][0]);o.default.info("fw-project links were sent to admin"),t.status(200).send(s)}else o.default.error("unauthorized user tried to get fw-project links as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("fw-project links sending failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to create fw-project link as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                                INSERT INTO fwProjectLink (${s.fields}) VALUES (${s.values});\n                            `),o.default.info("new fw-project link created by admin"),t.sendStatus(201)}else o.default.error("unauthorized user tried to create fw-project link as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("new fw-version creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/fw-project-links/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0),i=r.getIdFromUrl(e.originalUrl);if(s.authorized)if(s.permissions<=6)o.default.error(`user with low permissions tried to get fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const e=yield n.default.sqlRequest(`\n                                SELECT * FROM fwProjectLink WHERE id=${i};\n                            `);console.log("links:"),console.log(e);const s=yield n.default.sqlRequest(`\n                                SELECT * FROM projects, fws WHERE projects.projectId = ${e[0].projectId} AND fws.fwId = ${e[0].fwId};\n                            `),d=r.decodeEntity(s[0]);o.default.info(`fw-project link id:${i} was sent to admin`),t.status(200).send(d)}else o.default.error(`unauthorized user tried to get fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`fw-project link id:${r.getIdFromUrl(e.originalUrl)} sending to admin failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0),i=r.getIdFromUrl(e.originalUrl);if(s.authorized)if(s.permissions<=6)o.default.error(`user with low permissions tried to update fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const s=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                                UPDATE fwProjectLink SET ${s} WHERE id="${i}";\n                            `),o.default.info(`fw-project link id:${i} updated`),t.sendStatus(200)}else o.default.error(`unauthorized user tried to update fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`update fw-project link id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0),i=r.getIdFromUrl(e.originalUrl);s.authorized?s.permissions<=6?(o.default.error(`user with low permissions tried to delete fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(403)):(yield n.default.sqlRequest(`\n                                DELETE FROM fwProjectLink WHERE id="${i}";\n                            `),o.default.info(`fw-project link id:${i} deleted`),t.sendStatus(200)):(o.default.error(`unauthorized user tried to delete fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(401))}catch(s){o.default.error(`delete fw-project link id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(3);t.AppLinksAdminRoutes=class{routes(e){e.route("/api/admin/app-fw-project-links").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to get app-fw-project links as admin",r.attackerDetails(e)),t.sendStatus(403);else{const e=[];(yield n.default.sqlRequest("\n                                SELECT * FROM fwAppProjectLink;\n                            ")).forEach((t,s)=>{e[s]=n.default.sqlRequest(`\n                                    SELECT * FROM projects, fws, apps, fwAppProjectLink\n                                    WHERE projects.projectId = ${t.projectid}\n                                    AND fws.fwId = ${t.fwid}\n                                    AND apps.appId = ${t.appid}\n                                    AND fwAppProjectLink.projectid = ${t.projectid}\n                                    AND fwAppProjectLink.appid = ${t.appid}\n                                    AND fwAppProjectLink.fwid = ${t.fwid};\n                                `)});const s=yield Promise.all(e);for(let e=0;e<s.length;e++)s[e]=r.decodeEntity(s[e][0]);o.default.info("app-fw-project links were sent to admin"),t.status(200).send(s)}else o.default.error("unauthorized user tried to get app-fw-project links as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("app-fw-project links sending failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to create app-fw-project link as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                                INSERT INTO fwAppProjectLink (${s.fields}) VALUES (${s.values});\n                            `),o.default.info("new app-fw-project link created by admin"),t.sendStatus(201)}else o.default.error("unauthorized user tried to create app-fw-project link as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("new app-fw-version creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/app-fw-project-links/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0),i=r.getIdFromUrl(e.originalUrl);if(s.authorized)if(s.permissions<=6)o.default.error(`user with low permissions tried to get app-fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const e=yield n.default.sqlRequest(`\n                                SELECT * FROM fwAppProjectLink WHERE id=${i};\n                            `),s=yield n.default.sqlRequest(`\n                                SELECT * FROM projects, fws, apps, fwAppProjectLink\n                                WHERE projects.projectId = ${e[0].projectid}\n                                AND fws.fwId = ${e[0].fwid}\n                                AND apps.appId = ${e[0].appid};\n                            `),d=r.decodeEntity(s[0]);o.default.info(`app-fw-project link id:${i} was sent to admin`),t.status(200).send(d)}else o.default.error(`unauthorized user tried to get app-fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`app-fw-project link id:${r.getIdFromUrl(e.originalUrl)} sending to admin failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0),i=r.getIdFromUrl(e.originalUrl);if(s.authorized)if(s.permissions<=6)o.default.error(`user with low permissions tried to update app-fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const s=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                                UPDATE fwAppProjectLink SET ${s} WHERE id="${i}";\n                            `),o.default.info(`app-fw-project link id:${i} updated`),t.sendStatus(200)}else o.default.error(`unauthorized user tried to update app-fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`update app-fw-project link id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0),i=r.getIdFromUrl(e.originalUrl);s.authorized?s.permissions<=6?(o.default.error(`user with low permissions tried to delete app-fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(403)):(yield n.default.sqlRequest(`\n                                DELETE FROM fwAppProjectLink WHERE id="${i}";\n                            `),o.default.info(`app-fw-project link id:${i} deleted`),t.sendStatus(200)):(o.default.error(`unauthorized user tried to delete app-fw-project id:${i} link as admin`,r.attackerDetails(e)),t.sendStatus(401))}catch(s){o.default.error(`delete app-fw-project link id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(3);t.NewsAdminRoutes=class{routes(e){e.route("/api/admin/news").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to get news list as admin",r.attackerDetails(e)),t.sendStatus(403);else{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                                SELECT * FROM news ${s};\n                            `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("news were sent to admin"),t.status(200).send(i)}else o.default.error("unauthorized user tried to get news list as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("news sending to admin failed",e),t.status(500).send(e)}})).post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to create the new as admin",r.attackerDetails(e)),t.sendStatus(403);else{const s=r.createEntity(e.body);yield n.default.sqlRequest(`\n                                INSERT INTO news (${s.fields}) VALUES (${s.values});\n                            `),o.default.info(`the new "${e.body.title}" created`),t.sendStatus(201)}else o.default.error("unauthorized user tried to create the new as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("new new creation failed",e),t.status(500).send(e)}})),e.route("/api/admin/news/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield n.default.sqlRequest(`\n                        SELECT * FROM news WHERE id=${s};\n                    `),d=r.decodeEntity(i[0]);o.default.info(`the new id:${s} was sent to admin`),t.status(200).send(d)}catch(s){o.default.error(`the new id:${r.getIdFromUrl(e.originalUrl)} sending to admin failed`,s),t.status(500).send(s)}})).put((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=r.updateEntity(e.body);yield n.default.sqlRequest(`\n                        UPDATE news SET ${i} WHERE id="${s}";\n                    `),o.default.info(`the new id:${s} updated`),t.sendStatus(200)}catch(s){o.default.error(`update the new id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})).delete((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl);yield n.default.sqlRequest(`\n                        DELETE FROM news WHERE id="${s}";\n                    `),o.default.info(`the new id:${s} deleted`),t.sendStatus(200)}catch(s){o.default.error(`delete the new id:${r.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(0),d=s(3);t.StatisticsAdminRoutes=class{routes(e){e.route("/api/admin/statistics").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield d.default.verifyToken(e,!0);if(s.authorized)if(s.permissions<=6)o.default.error("user with low permissions tried to get devices statistics as admin",r.attackerDetails(e)),t.sendStatus(403);else{let s="";Object.keys(e.query).length&&(s=r.setFilters(e.query));const i=yield n.default.sqlRequest(`\n                                SELECT * FROM devices ${s};\n                            `);for(let e=0;e<i.length;e++)i[e]=r.decodeEntity(i[e]);o.default.info("devices statistics were sent to admin"),t.status(200).send(i)}else o.default.error("unauthorized user tried to get devices statistics as admin",r.attackerDetails(e)),t.sendStatus(401)}catch(e){o.default.error("devices statistics sending to admin failed",e),t.status(500).send(e)}})),e.route("/api/admin/statistics/:id").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=r.getIdFromUrl(e.originalUrl),i=yield d.default.verifyToken(e,!0);if(i.authorized)if(i.permissions<=6)o.default.error(`user with low permissions tried to get device id:${s} statistics as admin`,r.attackerDetails(e)),t.sendStatus(403);else{const e=yield n.default.sqlRequest(`\n                                SELECT * FROM devices WHERE id=${s};\n                            `),i=r.decodeEntity(e[0]);o.default.info(`device id:${s} statistics was sent to admin`),t.status(200).send(i)}else o.default.error(`unauthorized user tried to get device id:${s} statistics as admin`,r.attackerDetails(e)),t.sendStatus(401)}catch(s){o.default.error(`device id:${r.getIdFromUrl(e.originalUrl)} statistics sending to admin failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))(function(n,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(r,d)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(1),r=s(3),d=s(0);t.AdminRoutes=class{routes(e){e.route("/api/admin/login").post((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.login(e.body.email,e.body.password,!0);switch(s.code){case 200:yield n.default.sqlRequest(`\n                                UPDATE officers SET isOnline = 1 WHERE id = ${s.id};\n                            `),o.default.info(`user id:${s.id} login`),t.status(200).send({token:s.token,id:s.id,login:s.login,email:s.email});break;case 401:o.default.info(`incorrect password by user ${e.body.email}`),t.sendStatus(401);break;default:o.default.error("something wrong with autorization",d.attackerDetails(e))}}catch(s){o.default.error(`login failed for ${e.body.login}`,s),t.status(500).send(s)}})),e.route("/api/admin/logout").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e,!0);s?s.authorized?8!==s.permissions?(o.default.error("user with low permissions tried to login as admin",d.attackerDetails(e)),t.sendStatus(403)):(yield n.default.sqlRequest(`\n                                    UPDATE officers SET isOnline = 0 WHERE id = ${s.id};\n                                `),o.default.info(`user id:${s.id} logout`),t.sendStatus(200)):(o.default.error("unauthorized user tried to logout as admin",d.attackerDetails(e)),t.sendStatus(401)):(o.default.error("admin logout failed",{validity:s}),t.status(500).send({validity:s}))}catch(e){o.default.error("admin logout failed",e),t.status(500).send(e)}})),e.route("/api/admin/is-admin").get((e,t)=>i(this,void 0,void 0,function*(){try{const s=yield r.default.verifyToken(e,!0);s.authorized?8===s.permissions?(o.default.info(`user id:${s.id} informed that he is an admin`),t.status(200).send(!0)):(o.default.info(`user id:${s.id} informed that he is not an admin`),t.status(200).send(!1)):(o.default.error("unauthorized user tried to get permissions info",d.attackerDetails(e)),t.sendStatus(401))}catch(e){o.default.error("admin logout failed",e),t.status(500).send(e)}}))}}},function(e,t){e.exports=require("http")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(38),n=s(1);s(4).config();t.default=class{constructor(e){this._io=i(e),this._io.on("connection",e=>{n.default.info(`connected to socket ${e.id}`);const t=setInterval(()=>{e.emit("pinguin","Dmitry Guselnikov is a man")},4e3);e.on("error",e=>{n.default.error("Web socket errorr",e)}),e.on("error",e=>{n.default.error("Web socket errorr",e)}),e.on("testing event",t=>{n.default.info(`testing string from socket: ${t.message}`),e.emit("testing success",{overheared:t.message,reaction:"fuck yeah!"})}),e.on("disconnect",()=>{clearInterval(t)})})}emitTestingEvent(e){this._io.emit(e)}}},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("domain")}]);