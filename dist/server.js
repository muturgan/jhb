!function(e){var t={};function s(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=4)}([function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,u)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(11),r=s(12);const i=new class{constructor(){this._config=r.default}get sqlRequest(){return this._sqlRequest}_sqlRequest(e){return n(this,void 0,void 0,function*(){try{const t=yield o.createConnection(this._config),s=yield t.query(e);return t.end(),s}catch(e){throw e}})}};t.default=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(14);const o=new class{constructor(){this._logger=n.createLogger({format:n.format.combine(n.format.timestamp(),n.format.printf(e=>`\n    ${e.timestamp} [${e.level}]: ${e.message}`)),transports:[new n.transports.Console,new n.transports.File({filename:"combined.log"})]})}_info(e){this._logger.info(e)}get info(){return this._info}_error(e,t){let s=e+". ";if(t)for(let e in t)s+=`${e}: ${t[e]}; `;this._logger.error(s)}get error(){return this._error}};t.default=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(15);t.base64=n.Base64;const o=e=>"id"===e||"permissions"===e||"status"===e||"birthday"===e||"creationdate"===e||"updatingdate"===e||"likes"===e||"dislikes"===e;t.getIdFromUrl=(e=>{const t=e.split("/");return+t[t.length-1]}),t.createEntity=(e=>{let s="creationdate, ",n="NOW(), ";for(let o in e)s+=`${o}, `,n+="permissions"===o?`'${e[o]}', `:`'${t.base64.encode(String(e[o]))}', `;return{fields:s=s.substring(0,s.length-2),values:n=n.substring(0,n.length-2)}}),t.updateEntity=(e=>{let s="updatingdate = NOW(), ";for(let n in e)o(n)?s+=`${n} = '${e[n]}', `:s+=`${n} = '${t.base64.encode(String(e[n]))}', `;return s=s.substring(0,s.length-2)}),t.decodeEntity=(e=>{const s=e;for(let n in e){const r=e[n];if(!o(n)&&r){s[n]=t.base64.decode(r);const e=s[n];e&&(isNaN(+e)||(s[n]=+e))}}return s}),t.setFilters=(e=>{let s="";for(let n in e)o(n)?s+=`${n}=${e[n]} `:s+=`${n}='${t.base64.encode(e[n])}' `;return s=`WHERE ${s}`})},function(e,t){e.exports=require("dotenv")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(5);global.Promise=n,s(3).config();const o=s(6),r=s(1),i=process.env.PORT;o.default.listen(i,()=>{r.default.info(`Express server listening on port ${i}`)})},function(e,t){e.exports=require("bluebird")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(7),o=s(8),r=s(9),i=s(10),u=s(16),a=s(19),d=s(20);const l=(new class{constructor(){this._routePrv=new r.Routes,this._devRoutes=new i.DevRoutes,this._userApiRoutes=new u.UserApiRoutes,this._newsApiRoutes=new a.NewsApiRoutes,this.app=n(),this.config(),this._routePrv.routes(this.app),this._devRoutes.routes(this.app),this._userApiRoutes.routes(this.app),this._newsApiRoutes.routes(this.app)}config(){this.app.use(o.json()),this.app.use(o.urlencoded({extended:!1}))}}).app,c=new d.Server(l);t.default=c},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Routes=class{routes(e){e.route("/api/apps").get((e,t)=>{t.status(200).send({message:"You got the apps list..."})}),e.route("/api/apps/:id").get((e,t)=>{t.status(200).send({message:"You got the single app detail..."})}),e.route("/api/apps/:id/install").get((e,t)=>{t.status(200).send({message:"You tried to install a new app..."})}),e.route("/api/apps/:id/update").post((e,t)=>{t.status(200).send({message:"You tried to update the app..."})}),e.route("/api/version").get((e,t)=>{t.status(200).send({message:"You got the actual version information..."})}).post((e,t)=>{t.status(200).send({message:"You tried to update the version..."})}),e.route("/api/support").post((e,t)=>{t.status(200).send({message:"You tried to create a new support report..."})}),e.route("/api/support/history").post((e,t)=>{t.status(200).send({message:"You got the support reports history..."})}),e.route("/api/partners").get((e,t)=>{t.status(200).send({message:"You got the partners list..."})}),e.route("/api/partners/:id").get((e,t)=>{t.status(200).send({message:"You got the single partner detail..."})}),e.route("/api/partners").get((e,t)=>{t.status(200).send({message:"You got the company info..."})}),e.route("/entity").get((e,t)=>{t.status(200).send({message:"GET request successful."})}).post((e,t)=>{t.status(200).send({message:"POST request successful."})}),e.route("/entity/:entityId").get((e,t)=>{t.status(200).send({message:"GET request successful."})}).put((e,t)=>{t.status(200).send({message:"PUT request successful."})}).delete((e,t)=>{t.status(200).send({message:"DELETE request successful."})})}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,u)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(0),r=s(13),i=s(1),u=s(2);t.DevRoutes=class{routes(e){e.route("/").get((e,t)=>{t.status(200).send("GET request successful.")}),e.route("/getLogs").get((e,t)=>{try{t.sendFile(r.join(__dirname,"/combined.log")),i.default.info(`logs were sent to ${e.ip}`)}catch(s){i.default.error(`failed to send logs tp ${e.ip}`,s),t.status(500).send("db connection failed...")}}),e.route("/testDbConnection").get((e,t)=>n(this,void 0,void 0,function*(){try{yield o.default.sqlRequest("SELECT * FROM example"),t.status(200).send("db connection is fine!")}catch(e){t.status(500).send("db connection failed...")}})),e.route("/mysqler").post((e,t)=>n(this,void 0,void 0,function*(){try{const s=yield o.default.sqlRequest(e.body.query);t.status(200).send({rows:s})}catch(e){t.status(500).send(e)}})),e.route("/api/news").post((e,t)=>n(this,void 0,void 0,function*(){try{const s=u.createEntity(e.body.query);yield o.default.sqlRequest(`\n                        INSERT INTO news (${s.fields}) VALUES (${s.values});\n                    `),i.default.info(`the new "${e.body.query.login}" created`),t.sendStatus(200)}catch(e){i.default.error("new new creation failed",e),t.status(500).send(e)}}))}}},function(e,t){e.exports=require("promise-mysql")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s(3).config();const n={host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE,port:+process.env.DB_PORT};t.default=n},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("js-base64")},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,u)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(0),r=s(1),i=s(17),u=s(2);t.UserApiRoutes=class{routes(e){e.route("/api/user").post((e,t)=>n(this,void 0,void 0,function*(){try{const s=u.createEntity(e.body.query);yield o.default.sqlRequest(`\n                        INSERT INTO usersj (${s.fields}) VALUES (${s.values});\n                    `),r.default.info(`new user ${e.body.query.login} created`),t.sendStatus(200)}catch(e){r.default.error("new user creation failed",e),t.status(500).send(e)}})),e.route("/api/user/:id").get((e,t)=>n(this,void 0,void 0,function*(){try{const s=u.getIdFromUrl(e.originalUrl);if(yield i.default.verifyToken(s,e)){const e=yield o.default.sqlRequest(`\n                            SELECT *, NULL AS password FROM usersj WHERE id=${s};\n                        `),n=u.decodeEntity(e[0]);r.default.info(`got user id:${n.id} info`),t.status(200).send({user:n})}else r.default.error(`unauthorized user tried to get user id:${s} info`),t.sendStatus(401)}catch(s){r.default.error(`get user id:${u.getIdFromUrl(e.originalUrl)} info failed`,s),t.status(500).send(s)}})).put((e,t)=>n(this,void 0,void 0,function*(){try{const s=u.getIdFromUrl(e.originalUrl);if(yield i.default.verifyToken(s,e)){const n=u.updateEntity(e.body.query);yield o.default.sqlRequest(`\n                            UPDATE usersj SET ${n} WHERE id="${s}";\n                        `),r.default.info(`user id:${s} info updated`),t.sendStatus(200)}else r.default.error(`unauthorized user tried to update user id:${s} info`),t.sendStatus(401)}catch(s){r.default.error(`update user id:${u.getIdFromUrl(e.originalUrl)} info failed`,s),t.status(500).send(s)}})).delete((e,t)=>n(this,void 0,void 0,function*(){try{const s=u.getIdFromUrl(e.originalUrl);(yield i.default.verifyToken(s,e))?(yield o.default.sqlRequest(`\n                            DELETE FROM usersj WHERE id="${s}";\n                        `),r.default.info(`user id:${s} deleted`),t.sendStatus(200)):(r.default.error(`unauthorized user tried to delete user id:${s} info`),t.sendStatus(401))}catch(s){r.default.error(`delete user id:${u.getIdFromUrl(e.originalUrl)} failed`,s),t.status(500).send(s)}})),e.route("/api/user/login").post((e,t)=>n(this,void 0,void 0,function*(){try{const s=yield i.default.login(e.body.query);s?(yield o.default.sqlRequest(`\n                            UPDATE usersj SET status = 'online' WHERE id = ${s.id};\n                        `),r.default.info(`user id:${s.id} login`),t.status(200).send(s)):(r.default.info("incorrect password"),t.sendStatus(401))}catch(e){r.default.error("login failed",e),t.status(500).send(e)}})),e.route("/api/user/logout/:id").get((e,t)=>n(this,void 0,void 0,function*(){try{const s=u.getIdFromUrl(e.originalUrl);(yield i.default.verifyToken(s,e))?(yield o.default.sqlRequest(`\n                            UPDATE usersj SET status = 'offline' WHERE id = ${s};\n                        `),r.default.info(`user id:${s} logout`),t.sendStatus(200)):(r.default.error(`unauthorized user tried to logout user id:${s} info`),t.sendStatus(401))}catch(s){r.default.error(`user id:${u.getIdFromUrl(e.originalUrl)} logout failed`,s),t.status(500).send(s)}}))}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,u)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(18),r=s(2),i=s(0);const u=new class{get login(){return this._login}get verifyToken(){return this._verifyToken}_login(e){return n(this,void 0,void 0,function*(){try{const t=yield i.default.sqlRequest(`\n                SELECT login, id FROM usersj WHERE password="${r.base64.encode(e.password)}";\n            `);return!!t[0]&&{token:o(`Bearer: ${e.login}`).toString(),id:t[0].id}}catch(e){throw e}})}_verifyToken(e,t){return n(this,void 0,void 0,function*(){try{if(t.headers||t.headers.authorization){const s=yield i.default.sqlRequest(`\n                    SELECT login FROM usersj WHERE id="${e}";\n                `);return s[0]&&t.headers.authorization===o(`Bearer: ${r.base64.decode(s[0].login)}`).toString()?(console.log("true"),!0):(console.log("false"),!1)}return!1}catch(e){throw e}})}};t.default=u},function(e,t){e.exports=require("crypto-js/md5")},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,u)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(0),r=s(1),i=s(2);t.NewsApiRoutes=class{routes(e){e.route("/api/news").get((e,t)=>n(this,void 0,void 0,function*(){try{let s="";Object.keys(e.query).length&&(s=i.setFilters(e.query));const n=yield o.default.sqlRequest(`\n                        SELECT * FROM news ${s};\n                    `);for(let e of n)e=i.decodeEntity(e);r.default.info("news were sent"),t.status(200).send(n)}catch(e){r.default.error("news sending failed",e),t.status(500).send(e)}})),e.route("/api/news/:id").get((e,t)=>n(this,void 0,void 0,function*(){try{const s=i.getIdFromUrl(e.originalUrl),n=yield o.default.sqlRequest(`\n                        SELECT * FROM news WHERE id=${s};\n                    `),u=i.decodeEntity(n[0]);r.default.info(`the new id:${s} was sent`),t.status(200).send(u)}catch(s){r.default.error(`new id:${i.getIdFromUrl(e.originalUrl)} sending failed`,s),t.status(500).send(s)}}))}}},function(e,t){e.exports=require("http")}]);